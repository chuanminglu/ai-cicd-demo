# è´¨é‡é—¨æ£€æŸ¥æ‰§è¡ŒæŒ‡å—

## ğŸ“‹ æ‰§è¡Œå‘½ä»¤åºåˆ—

### 1. å®‰è£…ä¾èµ–

```bash
pip install pytest pytest-cov pylint -q
```

æˆ–ä½¿ç”¨requirements.txtï¼š

```bash
pip install -r requirements.txt
```

### 2. Pylintä»£ç è´¨é‡æ£€æŸ¥

```bash
python -m pylint src/ --fail-under=8.0
```

**è´¨é‡é—¨æ ‡å‡†ï¼š** è¯„åˆ† â‰¥ 8.0

**æ‰§è¡Œç»“æœç¤ºä¾‹ï¼š**
```
------------------------------------
Your code has been rated at 10.00/10
```

### 3. Pytestå•å…ƒæµ‹è¯•ä¸è¦†ç›–ç‡

```bash
python -m pytest tests/ --cov=src --cov-report=term-missing --cov-fail-under=80 -v
```

**è´¨é‡é—¨æ ‡å‡†ï¼š** 
- æ‰€æœ‰æµ‹è¯•é€šè¿‡
- ä»£ç è¦†ç›–ç‡ â‰¥ 80%

**æ‰§è¡Œç»“æœç¤ºä¾‹ï¼š**
```
============================= test session starts =============================
collected 3 items

tests/test_price_calculator.py::TestPriceCalculator::test_normal_calculation PASSED
tests/test_price_calculator.py::TestPriceCalculator::test_no_discount PASSED
tests/test_price_calculator.py::TestPriceCalculator::test_points_calculation PASSED

=============================== tests coverage ================================
Name                      Stmts   Miss  Cover   Missing
-------------------------------------------------------
src\price_calculator.py       9      0   100%
-------------------------------------------------------
TOTAL                         9      0   100%
Required test coverage of 80% reached. Total coverage: 100.00%
============================== 3 passed in 0.26s ==============================
```

---

## ğŸ“Š å¦‚ä½•æŸ¥çœ‹CoverageæŠ¥å‘Š

### æ–¹æ³•1ï¼šç»ˆç«¯æ–‡æœ¬æŠ¥å‘Šï¼ˆé»˜è®¤ï¼‰

æ‰§è¡Œæµ‹è¯•æ—¶è‡ªåŠ¨æ˜¾ç¤ºï¼š

```bash
pytest tests/ --cov=src --cov-report=term-missing -v
```

**è¾“å‡ºè¯´æ˜ï¼š**
- `Stmts`: ä»£ç è¯­å¥æ€»æ•°
- `Miss`: æœªè¦†ç›–çš„è¯­å¥æ•°
- `Cover`: è¦†ç›–ç‡ç™¾åˆ†æ¯”
- `Missing`: æœªè¦†ç›–çš„è¡Œå·

### æ–¹æ³•2ï¼šç”ŸæˆHTMLå¯è§†åŒ–æŠ¥å‘Šï¼ˆæ¨èï¼‰

```bash
pytest tests/ --cov=src --cov-report=html
```

**æŸ¥çœ‹æŠ¥å‘Šï¼š**
1. æŠ¥å‘Šç”Ÿæˆåœ¨ `htmlcov/` ç›®å½•
2. ç”¨æµè§ˆå™¨æ‰“å¼€ `htmlcov/index.html`
3. å¯æŸ¥çœ‹ï¼š
   - æ•´ä½“è¦†ç›–ç‡ç»Ÿè®¡
   - æ¯ä¸ªæ–‡ä»¶çš„è¦†ç›–è¯¦æƒ…
   - æœªè¦†ç›–ä»£ç çš„é«˜äº®æ˜¾ç¤º

**Windowså¿«é€Ÿæ‰“å¼€ï¼š**
```bash
start htmlcov/index.html
```

**Mac/Linuxå¿«é€Ÿæ‰“å¼€ï¼š**
```bash
open htmlcov/index.html    # Mac
xdg-open htmlcov/index.html # Linux
```

### æ–¹æ³•3ï¼šç”ŸæˆXMLæŠ¥å‘Šï¼ˆç”¨äºCI/CDï¼‰

```bash
pytest tests/ --cov=src --cov-report=xml
```

ç”Ÿæˆ `coverage.xml` æ–‡ä»¶ï¼Œé€‚åˆä¸CIå·¥å…·é›†æˆã€‚

### æ–¹æ³•4ï¼šç”ŸæˆJSONæŠ¥å‘Š

```bash
pytest tests/ --cov=src --cov-report=json
```

ç”Ÿæˆ `coverage.json` æ–‡ä»¶ï¼Œé€‚åˆç¨‹åºåŒ–åˆ†æã€‚

### æ–¹æ³•5ï¼šåŒæ—¶ç”Ÿæˆå¤šç§æŠ¥å‘Š

```bash
pytest tests/ --cov=src --cov-report=term-missing --cov-report=html --cov-report=xml -v
```

---

## ğŸ¯ å®Œæ•´è´¨é‡é—¨æ£€æŸ¥è„šæœ¬

åˆ›å»º `run_quality_check.sh` (Linux/Mac) æˆ– `run_quality_check.bat` (Windows)ï¼š

### Windowsç‰ˆæœ¬ (run_quality_check.bat)

```batch
@echo off
echo ================================================
echo å¼€å§‹è´¨é‡é—¨æ£€æŸ¥
echo ================================================

echo.
echo [1/3] å®‰è£…ä¾èµ–...
pip install -r requirements.txt -q

echo.
echo [2/3] Pylintä»£ç è´¨é‡æ£€æŸ¥...
python -m pylint src/ --fail-under=8.0
if %errorlevel% neq 0 (
    echo âŒ Pylintæ£€æŸ¥å¤±è´¥
    exit /b 1
)
echo âœ… Pylintæ£€æŸ¥é€šè¿‡

echo.
echo [3/3] Pytestæµ‹è¯•ä¸è¦†ç›–ç‡...
python -m pytest tests/ --cov=src --cov-report=term-missing --cov-report=html --cov-fail-under=80 -v
if %errorlevel% neq 0 (
    echo âŒ æµ‹è¯•æˆ–è¦†ç›–ç‡æ£€æŸ¥å¤±è´¥
    exit /b 1
)
echo âœ… æµ‹è¯•é€šè¿‡ï¼Œè¦†ç›–ç‡è¾¾æ ‡

echo.
echo ================================================
echo âœ… æ‰€æœ‰è´¨é‡é—¨æ£€æŸ¥é€šè¿‡ï¼
echo ğŸ“Š HTMLè¦†ç›–ç‡æŠ¥å‘Š: htmlcov\index.html
echo ================================================

start htmlcov\index.html
```

### Linux/Macç‰ˆæœ¬ (run_quality_check.sh)

```bash
#!/bin/bash

echo "================================================"
echo "å¼€å§‹è´¨é‡é—¨æ£€æŸ¥"
echo "================================================"

echo ""
echo "[1/3] å®‰è£…ä¾èµ–..."
pip install -r requirements.txt -q

echo ""
echo "[2/3] Pylintä»£ç è´¨é‡æ£€æŸ¥..."
python -m pylint src/ --fail-under=8.0
if [ $? -ne 0 ]; then
    echo "âŒ Pylintæ£€æŸ¥å¤±è´¥"
    exit 1
fi
echo "âœ… Pylintæ£€æŸ¥é€šè¿‡"

echo ""
echo "[3/3] Pytestæµ‹è¯•ä¸è¦†ç›–ç‡..."
python -m pytest tests/ --cov=src --cov-report=term-missing --cov-report=html --cov-fail-under=80 -v
if [ $? -ne 0 ]; then
    echo "âŒ æµ‹è¯•æˆ–è¦†ç›–ç‡æ£€æŸ¥å¤±è´¥"
    exit 1
fi
echo "âœ… æµ‹è¯•é€šè¿‡ï¼Œè¦†ç›–ç‡è¾¾æ ‡"

echo ""
echo "================================================"
echo "âœ… æ‰€æœ‰è´¨é‡é—¨æ£€æŸ¥é€šè¿‡ï¼"
echo "ğŸ“Š HTMLè¦†ç›–ç‡æŠ¥å‘Š: htmlcov/index.html"
echo "================================================"

# Mac
if [[ "$OSTYPE" == "darwin"* ]]; then
    open htmlcov/index.html
# Linux
else
    xdg-open htmlcov/index.html 2>/dev/null
fi
```

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
# Windows
run_quality_check.bat

# Linux/Mac
chmod +x run_quality_check.sh
./run_quality_check.sh
```

---

## ğŸ” GitHub Actionsä¸­æŸ¥çœ‹Coverage

åœ¨GitHub Actionsæ‰§è¡Œåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹ï¼š

### 1. åœ¨Actionsæ—¥å¿—ä¸­æŸ¥çœ‹

- è¿›å…¥ä»“åº“çš„ **Actions** æ ‡ç­¾é¡µ
- ç‚¹å‡»å¯¹åº”çš„workflowè¿è¡Œè®°å½•
- å±•å¼€ **"Pytestå•å…ƒæµ‹è¯•ä¸è¦†ç›–ç‡"** æ­¥éª¤
- æŸ¥çœ‹ç»ˆç«¯è¾“å‡ºçš„è¦†ç›–ç‡æŠ¥å‘Š

### 2. ä¸‹è½½Coverage Artifact

- åœ¨workflowè¿è¡Œè¯¦æƒ…é¡µé¢ï¼Œæ»šåŠ¨åˆ°åº•éƒ¨
- æ‰¾åˆ° **Artifacts** åŒºåŸŸ
- ä¸‹è½½ `coverage-report` æ–‡ä»¶
- è§£å‹åå¯ä»¥ä½¿ç”¨coverageå·¥å…·æŸ¥çœ‹

### 3. ä½¿ç”¨Coverage Badgeï¼ˆå¯é€‰ï¼‰

å¯ä»¥åœ¨READMEä¸­æ·»åŠ è¦†ç›–ç‡å¾½ç« ï¼š

```markdown
![Coverage](https://img.shields.io/badge/coverage-100%25-brightgreen)
```

æˆ–é›†æˆç¬¬ä¸‰æ–¹æœåŠ¡å¦‚ Codecovã€Coveralls è‡ªåŠ¨ç”Ÿæˆå¾½ç« ã€‚

---

## ğŸ“ è´¨é‡é—¨é€šè¿‡æ ‡å‡†

| æ£€æŸ¥é¡¹ | æ ‡å‡† | å½“å‰çŠ¶æ€ |
|--------|------|----------|
| Pylintè¯„åˆ† | â‰¥ 8.0 | âœ… 10.0/10 |
| å•å…ƒæµ‹è¯• | å…¨éƒ¨é€šè¿‡ | âœ… 3/3 |
| ä»£ç è¦†ç›–ç‡ | â‰¥ 80% | âœ… 100% |

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¿½ç•¥æŸäº›æ–‡ä»¶çš„Pylintæ£€æŸ¥ï¼Ÿ

åˆ›å»º `.pylintrc` æ–‡ä»¶ï¼š

```ini
[MASTER]
ignore=migrations,tests
```

### Q: å¦‚ä½•è®¾ç½®coverageå¿½ç•¥æŸäº›ä»£ç ï¼Ÿ

åœ¨ `pyproject.toml` æˆ– `.coveragerc` ä¸­é…ç½®ï¼š

```ini
[coverage:run]
omit = 
    */tests/*
    */migrations/*
    */__init__.py

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise NotImplementedError
```

### Q: æµ‹è¯•å¤±è´¥ä½†éœ€è¦ä¸´æ—¶è·³è¿‡ï¼Ÿ

ä½¿ç”¨pytestçš„skipè£…é¥°å™¨ï¼š

```python
@pytest.mark.skip(reason="ä¸´æ—¶è·³è¿‡")
def test_something():
    pass
```

---

**æ–‡æ¡£æ›´æ–°æ—¶é—´ï¼š** 2026-01-11
